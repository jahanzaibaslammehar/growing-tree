<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Thank You - Tree Leaves</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-image: url('Background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      position: relative;
    }

    /* UNICEF Logo */
    .unicef-logo {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 180px;
      height: auto;
      z-index: 10;
    }

    /* Main Container */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
      max-width: 400px;
      padding: 40px 20px;
      animation: slideIn 0.8s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Leaf Image */
    .leaf-image {
      width: 240px;
      height: auto;
      margin-bottom: 30px;
      animation: float 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-15px);
      }
    }

    /* Pledge Text SVG */
    .pledge-text {
      width: 100%;
      max-width: 350px;
      height: auto;
      margin-bottom: 30px;
      filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.2));
    }

    /* Count Me In Button */
    .count-me-in-btn {
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      max-width: 300px;
      display: block;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }

    .count-me-in {
      width: 100%;
      height: auto;
      display: block;
      transition: all 0.3s ease;
      filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
    }

    .count-me-in-btn:hover .count-me-in {
      transform: scale(1.05);
      filter: drop-shadow(0 8px 25px rgba(0, 0, 0, 0.4));
    }

    .count-me-in-btn:active .count-me-in {
      transform: scale(0.95);
    }

    .count-me-in-btn:focus {
      outline: none;
    }

    .count-me-in-btn:focus .count-me-in {
      filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 0 3px rgba(0, 174, 239, 0.5));
    }

    /* Sparkles Effect */
    .sparkles {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #f39c12;
      border-radius: 50%;
      animation: sparkle 2s linear infinite;
    }

    @keyframes sparkle {
      0% {
        opacity: 0;
        transform: scale(0);
      }
      50% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0);
      }
    }

    /* Thank You Popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .popup-overlay.show {
      display: flex;
    }

    .popup-content {
      background: white;
      border-radius: 20px;
      padding: 40px 30px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      max-width: 300px;
      width: 90%;
      animation: popupSlideIn 0.3s ease-out;
    }

    @keyframes popupSlideIn {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .popup-icon {
      font-size: 50px;
      margin-bottom: 15px;
    }

    .popup-title {
      color: #2c3e50;
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .popup-message {
      color: #7f8c8d;
      font-size: 1rem;
      margin-bottom: 25px;
    }

    .popup-close {
      background: #27ae60;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .popup-close:hover {
      background: #229954;
      transform: translateY(-2px);
    }

    /* Mobile Optimizations */
    @media (max-width: 480px) {
      .unicef-logo {
        width: 120px;
        top: 15px;
        right: 15px;
      }
      
      .container {
        padding: 30px 15px;
        max-width: 350px;
      }
      
      .leaf-image {
        width: 200px;
        margin-bottom: 25px;
      }
      
      .pledge-text {
        max-width: 300px;
        margin-bottom: 25px;
      }
      
      .count-me-in-btn {
        max-width: 280px;
      }
    }

    @media (max-width: 360px) {
      .container {
        padding: 20px 10px;
        max-width: 320px;
      }
      
      .leaf-image {
        width: 180px;
        margin-bottom: 20px;
      }
      
      .pledge-text {
        max-width: 280px;
        margin-bottom: 20px;
      }
      
      .count-me-in-btn {
        max-width: 260px;
      }
    }
  </style>
</head>
<body>
  <div class="sparkles" id="sparkles"></div>
  
  <!-- UNICEF Logo -->
  <img src="unicef_logo.svg" alt="UNICEF Logo" class="unicef-logo">
  
  <div class="container">
    <!-- Leaf Image -->
    <img src="leaf_new.png" alt="Leaf" class="leaf-image">
    
    <!-- Pledge Text PNG -->
    <img src="pledge_text.png" alt="I pledge to plant hope for every child" class="pledge-text">
    
    <!-- Count Me In Button -->
    <button class="count-me-in-btn">
      <img src="count_me_in.svg" alt="Count Me In" class="count-me-in">
    </button>
  </div>

  <!-- Thank You Popup -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-content">
      <div class="popup-icon">üå±</div>
      <div class="popup-title">Thank You!</div>
      <div class="popup-message">Your pledge has been recorded!</div>
      <button class="popup-close" onclick="closePopup()">Close</button>
    </div>
  </div>

  <script>
    // Function to handle Count Me In button click
    function handleCountMeIn() {
      // Add visual feedback
      const button = document.querySelector('.count-me-in-btn');
      const image = document.querySelector('.count-me-in');
      
      // Animate the button
      image.style.transform = 'scale(0.95)';
      
      setTimeout(() => {
        image.style.transform = 'scale(1.05)';
        setTimeout(() => {
          image.style.transform = 'scale(1)';
        }, 150);
      }, 150);
      
      // Create extra sparkles on click
      createClickSparkles();
      
      // Add a new leaf to the server
      addNewLeaf();
      
      // Show popup
      showPopup();
    }

    // Function to show popup
    function showPopup() {
      document.getElementById('popupOverlay').classList.add('show');
    }

    // Function to close popup
    function closePopup() {
      document.getElementById('popupOverlay').classList.remove('show');
    }
    
    // Function to add a new grown leaf to server
    async function addNewLeaf() {
      try {
        const leafData = {
          source: 'thank-you-page'
        };
        
        const response = await fetch('/api/leaves', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Cache-Control': 'no-cache, no-store, must-revalidate',
            'Pragma': 'no-cache',
            'Expires': '0'
          },
          body: JSON.stringify(leafData)
        });
        
        const result = await response.json();
        
        if (result.success) {
          console.log(`‚úÖ New leaf added from thank-you page:`, result.leaf);
        } else {
          console.error('‚ùå Failed to add leaf to server:', result.error);
        }
      } catch (error) {
        console.error('Error adding leaf to server:', error);
      }
    }
    
    // Function to create sparkle effects
    function createSparkles() {
      const sparklesContainer = document.getElementById('sparkles');
      const sparkleCount = 15;
      
      for (let i = 0; i < sparkleCount; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.className = 'sparkle';
          sparkle.style.left = Math.random() * 100 + '%';
          sparkle.style.top = Math.random() * 100 + '%';
          sparkle.style.animationDelay = Math.random() * 2 + 's';
          sparklesContainer.appendChild(sparkle);
          
          // Remove sparkle after animation
          setTimeout(() => {
            if (sparkle.parentNode) {
              sparkle.parentNode.removeChild(sparkle);
            }
          }, 2000);
        }, i * 100);
      }
    }
    
    // Function to create sparkles on click
    function createClickSparkles() {
      const sparklesContainer = document.getElementById('sparkles');
      const sparkleCount = 8;
      
      for (let i = 0; i < sparkleCount; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = (Math.random() * 80 + 10) + '%';
        sparkle.style.top = (Math.random() * 80 + 10) + '%';
        sparkle.style.animationDelay = Math.random() * 0.5 + 's';
        sparklesContainer.appendChild(sparkle);
        
        // Remove sparkle after animation
        setTimeout(() => {
          if (sparkle.parentNode) {
            sparkle.parentNode.removeChild(sparkle);
          }
        }, 2000);
      }
    }
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Create initial sparkle effects
      createSparkles();
      
      // Add click event to overlay to close popup
      document.getElementById('popupOverlay').addEventListener('click', closePopup);
      
      // Add touch event handlers for mobile compatibility
      const countMeInBtn = document.querySelector('.count-me-in-btn');
      if (countMeInBtn) {
        // Add touch events for better mobile support
        countMeInBtn.addEventListener('touchstart', function(e) {
          e.preventDefault();
          // Add visual feedback immediately on touch
          const image = document.querySelector('.count-me-in');
          image.style.transform = 'scale(0.95)';
        });
        
        countMeInBtn.addEventListener('touchend', function(e) {
          e.preventDefault();
          // Trigger the click handler
          handleCountMeIn();
        });
        
        // Also keep the regular click event for desktop
        countMeInBtn.addEventListener('click', function(e) {
          e.preventDefault();
          handleCountMeIn();
        });
      }
      
      console.log('Thank you page loaded with new mobile design!');
    });
    
    // Add interactive sparkles on any click
    document.addEventListener('click', function(e) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.style.left = e.clientX + 'px';
      sparkle.style.top = e.clientY + 'px';
      sparkle.style.position = 'fixed';
      sparkle.style.pointerEvents = 'none';
      sparkle.style.zIndex = '1000';
      document.body.appendChild(sparkle);
      
      setTimeout(() => {
        if (sparkle.parentNode) {
          sparkle.parentNode.removeChild(sparkle);
        }
      }, 2000);
    });
  </script>
</body>
</html>
